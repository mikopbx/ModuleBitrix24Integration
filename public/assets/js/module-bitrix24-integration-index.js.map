{"version":3,"sources":["src/module-bitrix24-integration-index.js"],"names":["ModuleBitrix24Integration","$formObj","$","validateRules","portal","identifier","rules","type","prompt","globalTranslate","mod_b24_i_ValidatePortalEmpty","client_id","mod_b24_i_ValidateClientIDEmpty","client_secret","mod_b24_i_ValidateClientSecretEmpty","initialize","initializeForm","testConnection","applyConfigurationChanges","api","url","Config","pbxUrl","on","successTest","response","Object","keys","length","result","toUpperCase","onSuccess","cbBeforeSendForm","settings","data","form","cbAfterSendForm","Form","globalRootUrl","auth","window","location","val","remove","FullName","LAST_NAME","NAME","before","concat","module_b24_i_ConnectionSuccess","module_b24_i_ConnectionError","console","log","onFailure","document","ready"],"mappings":"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","sourcesContent":["/*\n * Copyright © MIKO LLC - All Rights Reserved\n * Unauthorized copying of this file, via any medium is strictly prohibited\n * Proprietary and confidential\n * Written by Alexey Portnov, 3 2019\n */\n\n/* global globalRootUrl,globalTranslate, Form, Config */\nconst ModuleBitrix24Integration = {\n\t$formObj: $('#module-bitrix24-integration-form'),\n\tvalidateRules: {\n\t\tportal: {\n\t\t\tidentifier: 'portal',\n\t\t\trules: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'empty',\n\t\t\t\t\tprompt: globalTranslate.mod_b24_i_ValidatePortalEmpty,\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\tclient_id: {\n\t\t\tidentifier: 'client_id',\n\t\t\trules: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'empty',\n\t\t\t\t\tprompt: globalTranslate.mod_b24_i_ValidateClientIDEmpty,\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\tclient_secret: {\n\t\t\tidentifier: 'client_secret',\n\t\t\trules: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'empty',\n\t\t\t\t\tprompt: globalTranslate.mod_b24_i_ValidateClientSecretEmpty,\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t},\n\tinitialize() {\n\t\tModuleBitrix24Integration.initializeForm();\n\t\tModuleBitrix24Integration.testConnection();\n\t},\n\t/**\n\t * Применение настроек модуля после изменения данных формы\n\t */\n\tapplyConfigurationChanges() {\n\t\t$.api({\n\t\t\turl: `${Config.pbxUrl}/pbxcore/api/modules/ModuleBitrix24Integration/reload`,\n\t\t\ton: 'now',\n\t\t\tsuccessTest(response) {\n\t\t\t\t// test whether a JSON response is valid\n\t\t\t\treturn Object.keys(response).length > 0 && response.result.toUpperCase() === 'SUCCESS';\n\t\t\t},\n\t\t\tonSuccess() {\n\n\t\t\t},\n\t\t});\n\t},\n\tcbBeforeSendForm(settings) {\n\t\tconst result = settings;\n\t\tresult.data = ModuleBitrix24Integration.$formObj.form('get values');\n\t\treturn result;\n\t},\n\tcbAfterSendForm() {\n\t\tModuleBitrix24Integration.applyConfigurationChanges();\n\t},\n\tinitializeForm() {\n\t\tForm.$formObj = ModuleBitrix24Integration.$formObj;\n\t\tForm.url = `${globalRootUrl}module-bitrix24-integration/save`;\n\t\tForm.validateRules = ModuleBitrix24Integration.validateRules;\n\t\tForm.cbBeforeSendForm = ModuleBitrix24Integration.cbBeforeSendForm;\n\t\tForm.cbAfterSendForm = ModuleBitrix24Integration.cbAfterSendForm;\n\t\tForm.initialize();\n\t},\n    auth() {\n        window.location='/pbxcore/api/modules/ModuleBitrix24Integration/custom_action?portal='+$(\"#portal\").val();\n    },\n\ttestConnection() {\n\t// if (!(moduleSmartIVR.$formObj.form('is valid'))) return;\n\t$.api({\n\t\turl: `${Config.pbxUrl}/pbxcore/api/modules/ModuleBitrix24Integration/check`,\n\t\ton: 'now',\n\t\tsuccessTest(response) {\n\t\t\t// test whether a JSON response is valid\n\t\t\t// return Object.keys(response).length > 0 && response.result.toUpperCase() === 'SUCCESS';\n\t\t\tlet result = Object.keys(response).length > 0 && response.result.toUpperCase() === 'SUCCESS';\n\t\t\t$('.ui.message.ajax').remove();\n\t\t\tif (result) {\n\t\t\t\tlet FullName = response.data.data.LAST_NAME + ' ' + response.data.data.NAME;\n\t\t\t\tModuleBitrix24Integration.$formObj.before(\"<div class=\\\"ui positive message ajax\\\">\".concat(globalTranslate.module_b24_i_ConnectionSuccess, \" (\"+FullName+\")</div>\"));\n\t\t\t} else {\n\t\t\t\tModuleBitrix24Integration.$formObj.before(\"<div class=\\\"ui negative message ajax\\\">\".concat(globalTranslate.module_b24_i_ConnectionError, \"</div>\"));\n\t\t\t}\n\t\t},\n\t\tonSuccess() {\n\t\t\t// moduleSmartIVR.cbAfterTestSend(true);\n\t\t\tconsole.log('onSuccess');\n\t\t},\n\t\tonFailure() {\n\t\t\t// moduleSmartIVR.cbAfterTestSend(false);\n\t\t\tconsole.log('onFailure');\n\t\t},\n\t});\n},\n};\n\n$(document).ready(() => {\n\tModuleBitrix24Integration.initialize();\n});\n\n"],"file":"module-bitrix24-integration-index.js"}